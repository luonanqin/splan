package luonq.strategy;

import bean.StockKLine;
import com.google.common.collect.Maps;
import org.apache.commons.collections4.MapUtils;
import util.BaseUtils;
import util.Constants;

import java.math.BigDecimal;
import java.util.Comparator;
import java.util.List;
import java.util.Map;
import java.util.Set;
import java.util.stream.Collectors;

/**
 * 按照开盘低于前日收盘的跌幅倒排，选择可以做空的股票，开盘即卖出，半小时内平仓获得利润（先按照开盘价直接计算，符合预期后再拉盘前最后一次的交易再进行复测）
 * 1.先按收盘卖出计算利润
 */
public class Strategy27 {

    public static Map<String, Double> buildPreMarketTrade() {
        Map<String, Double> map = Maps.newHashMap();
        map.put("W", 60.73);
        map.put("C", 60.18);
        map.put("CMTG", 8.78);
        map.put("S", 21.68);
        map.put("BEN", 25.55);
        map.put("JAGX", 0.1023);
        map.put("BCE", 32.25);
        map.put("SLAB", 127.36);
        map.put("AGNC", 9.33);
        map.put("BBY", 78.7);
        map.put("O", 52.31);
        map.put("M", 19.47);
        map.put("URGN", 15.5);
        map.put("AXNX", 67.74);
        map.put("V", 277.14);
        map.put("F", 12.72);
        map.put("T", 16.45);
        map.put("AXON", 318.02);
        map.put("NVDA", 891.0);
        map.put("SES", 1.7402);
        map.put("U", 25.2);
        map.put("SHO", 10.87);
        map.put("BBAI", 1.72);
        map.put("SLDP", 1.67);
        map.put("AXTI", 3.45);
        map.put("BIP", 26.0);
        map.put("AXSM", 69.0);
        map.put("STWD", 19.45);
        map.put("STRO", 4.12);
        map.put("STRL", 106.04);
        map.put("APDN", 0.397);
        map.put("BHF", 48.44);
        map.put("SKX", 57.41);
        map.put("MSFT", 426.52);
        map.put("SLB", 52.64);
        map.put("SLM", 20.89);
        map.put("SLS", 1.31);
        map.put("BKR", 33.25);
        map.put("ZYME", 9.25);
        map.put("SMR", 5.33);
        map.put("CELH", 80.01);
        map.put("PCAR", 120.52);
        map.put("KMDA", 5.21);
        map.put("SNY", 46.75);
        map.put("TGAN", 4.86);
        map.put("PTEN", 11.75);
        map.put("CENX", 17.24);
        map.put("SPG", 145.95);
        map.put("BON", 3.88);
        map.put("BMY", 48.24);
        map.put("LGVN", 2.38);
        map.put("CVNA", 74.9);
        map.put("IONQ", 8.01);
        map.put("APLS", 51.7);
        map.put("VUZI", 1.31);
        map.put("APLD", 2.71);
        map.put("FFIE", 0.079);
        map.put("KEY", 14.82);
        map.put("BRY", 8.44);
        map.put("HUBG", 40.86);
        map.put("NEOV", 2.32);
        map.put("TOST", 24.24);
        map.put("STX", 86.86);
        map.put("KDP", 30.33);
        map.put("BSX", 68.7);
        map.put("BTU", 23.08);
        map.put("KEN", 20.55);
        map.put("SLNA", 0.0746);
        map.put("GILD", 68.54);
        map.put("BUD", 58.78);
        map.put("SWI", 10.87);
        map.put("APPS", 1.85);
        map.put("SWN", 7.43);
        map.put("HUBS", 667.0);
        map.put("SUZ", 11.73);
        map.put("RIOT", 9.01);
        map.put("KHC", 36.19);
        map.put("BWA", 33.67);
        map.put("PTON", 3.55);
        map.put("CNHI", 12.74);
        map.put("PTPI", 0.8174);
        map.put("NEXT", 6.13);
        map.put("APTV", 74.02);
        map.put("PTLO", 12.91);
        map.put("MSTR", 1470.0);
        map.put("KKR", 98.5);
        map.put("RIVN", 9.13);
        map.put("MKFG", 0.6822);
        map.put("RACE", 419.94);
        map.put("KMI", 18.34);
        map.put("APVO", 0.85);
        map.put("KMX", 71.16);
        map.put("CAG", 29.59);
        map.put("TXRH", 149.6);
        map.put("KRP", 16.11);
        map.put("PLAB", 27.9);
        map.put("USAP", 24.63);
        map.put("CAH", 106.56);
        map.put("CAN", 1.21);
        map.put("TAK", 13.26);
        map.put("CAT", 373.48);
        map.put("TDG", 1230.0);
        map.put("TDC", 36.05);
        map.put("UBER", 76.52);
        map.put("TER", 107.43);
        map.put("TEL", 144.13);
        map.put("TFC", 37.2);
        map.put("KSS", 23.13);
        map.put("CCO", 1.53);
        map.put("CEG", 194.05);
        map.put("CNSL", 4.29);
        map.put("CCJ", 49.724);
        map.put("CDW", 246.26);
        map.put("CCI", 96.24);
        map.put("BKNG", 3580.0);
        map.put("CWCO", 24.8);
        map.put("CCL", 14.64);
        map.put("MTDR", 68.75);
        map.put("RARE", 44.49);
        map.put("TGI", 13.97);
        map.put("MKTX", 213.87);
        map.put("MTCH", 32.79);
        map.put("CGC", 7.5996);
        map.put("JBHT", 186.86);
        map.put("BTBT", 2.07);
        map.put("SMAR", 37.65);
        map.put("TJX", 95.01);
        map.put("SMCI", 912.0);
        map.put("TGT", 169.87);
        map.put("CIM", 4.08);
        map.put("CHK", 88.61);
        map.put("TPIC", 2.61);
        map.put("CLS", 44.97);
        map.put("FOUR", 64.0);
        map.put("PUBM", 22.86);
        map.put("CNC", 75.74);
        map.put("CMC", 55.25);
        map.put("GRWG", 2.38);
        map.put("CLF", 21.89);
        map.put("FORM", 45.0);
        map.put("MCHP", 87.8);
        map.put("EDBL", 5.71);
        map.put("VERB", 0.1801);
        map.put("QGEN", 40.43);
        map.put("VERI", 4.87);
        map.put("CNM", 57.26);
        map.put("SMLR", 27.69);
        map.put("PDCO", 25.39);
        map.put("CNP", 27.65);
        map.put("CNX", 24.28);
        map.put("CNK", 17.85);
        map.put("COF", 141.5);
        map.put("LAC", 7.04);
        map.put("BCLI", 0.5801);
        map.put("TPR", 42.38);
        map.put("TRV", 223.58);
        map.put("COCO", 25.15);
        map.put("ORCL", 121.9);
        map.put("COP", 132.43);
        map.put("TTD", 86.55);
        map.put("CPG", 8.84);
        map.put("NFLX", 630.19);
        map.put("TSN", 58.0);
        map.put("LEN", 159.7);
        map.put("CSX", 35.69);
        map.put("TTI", 4.65);
        map.put("PLUG", 2.9);
        map.put("CUK", 13.24);
        map.put("MTSI", 99.2);
        map.put("PLTR", 22.83);
        map.put("TSM", 145.34);
        map.put("CRM", 282.88);
        map.put("CUZ", 22.37);
        map.put("TXG", 34.66);
        map.put("MLCO", 6.99);
        map.put("TXN", 168.28);
        map.put("COIN", 247.8);
        map.put("LICY", 0.8371);
        map.put("SMTC", 33.0);
        map.put("CXM", 11.55);
        map.put("CVX", 159.63);
        map.put("FPAY", 1.13);
        map.put("LMB", 39.7);
        map.put("MLGO", 2.85);
        map.put("CZR", 40.49);
        map.put("LMT", 458.9);
        map.put("NOMD", 18.51);
        map.put("LPG", 39.47);
        map.put("UAL", 42.2);
        map.put("LNT", 48.17);
        map.put("UBS", 29.08);
        map.put("DAL", 47.23);
        map.put("COLL", 35.7);
        map.put("DARE", 0.4675);
        map.put("LLY", 760.0);
        map.put("LOW", 235.47);
        map.put("LKQ", 50.04);
        map.put("DAR", 44.17);
        map.put("DASH", 139.0);
        map.put("RBLX", 38.38);
        map.put("DDD", 3.98);
        map.put("LILA", 7.3);
        map.put("COST", 735.56);
        map.put("BJ", 76.8);
        map.put("BE", 10.54);
        map.put("BG", 104.86);
        map.put("BA", 170.7);
        map.put("DHI", 151.7);
        map.put("DFS", 122.5);
        map.put("AG", 7.6);
        map.put("AB", 32.5);
        map.put("AY", 18.27);
        map.put("ARBK", 1.47);
        map.put("DAWN", 13.85);
        map.put("AI", 22.33);
        map.put("COUR", 13.06);
        map.put("LUV", 27.85);
        map.put("ARCO", 10.92);
        map.put("LVS", 50.71);
        map.put("AA", 37.0);
        map.put("SNDL", 1.99);
        map.put("SNDR", 21.73);
        map.put("SNAP", 10.87);
        map.put("BN", 39.49);
        map.put("DHR", 241.98);
        map.put("BP", 39.5);
        map.put("BW", 1.07);
        map.put("BX", 124.51);
        map.put("DT", 46.12);
        map.put("DX", 11.86);
        map.put("LYV", 102.0);
        map.put("LYB", 101.58);
        map.put("ED", 89.94);
        map.put("LRCX", 977.35);
        map.put("WIRE", 288.95);
        map.put("DKS", 205.47);
        map.put("DK", 31.02);
        map.put("ET", 15.54);
        map.put("EH", 17.15);
        map.put("EVBG", 34.86);
        map.put("EC", 11.84);
        map.put("EL", 140.25);
        map.put("WISA", 1.8998);
        map.put("DD", 74.41);
        map.put("AZUL", 6.36);
        map.put("AADI", 1.96);
        map.put("CL", 86.85);
        map.put("DIS", 115.19);
        map.put("SNGX", 0.6771);
        map.put("FE", 37.61);
        map.put("DLO", 15.94);
        map.put("GD", 291.91);
        map.put("JD", 25.91);
        map.put("GL", 59.06);
        map.put("IP", 37.38);
        map.put("GE", 157.04);
        map.put("UNH", 441.5);
        map.put("GM", 43.77);
        map.put("DLR", 144.07);
        map.put("HE", 10.7);
        map.put("HL", 5.52);
        map.put("DNA", 1.03);
        map.put("GS", 407.5);
        map.put("UNP", 237.61);
        map.put("DOW", 58.3);
        map.put("ARGX", 379.08);
        map.put("BLZE", 9.35);
        map.put("HD", 345.89);
        map.put("MDLZ", 67.32);
        map.put("UPS", 145.35);
        map.put("URI", 686.38);
        map.put("MAR", 255.33);
        map.put("RKLB", 3.76);
        map.put("MCO", 381.2);
        map.put("MCK", 524.0);
        map.put("MP", 16.93);
        map.put("DSX", 2.89);
        map.put("KO", 58.61);
        map.put("LE", 13.04);
        map.put("UTI", 15.07);
        map.put("NXPL", 1.59);
        map.put("KR", 55.64);
        map.put("LW", 80.51);
        map.put("NPCE", 13.5);
        map.put("MA", 471.22);
        map.put("PMVP", 1.8001);
        map.put("MDT", 81.24);
        map.put("MO", 41.255);
        map.put("MU", 123.55);
        map.put("NXPI", 237.49);
        map.put("MCD", 267.8);
        map.put("MS", 87.69);
        map.put("NE", 49.11);
        map.put("SNPS", 568.96);
        map.put("SNOW", 156.42);
        map.put("NU", 11.22);
        map.put("PG", 156.5);
        map.put("SNPO", 10.63);
        map.put("RF", 19.32);
        map.put("TIGO", 20.12);
        map.put("AAOI", 11.39);
        map.put("ARRW", 12.9);
        map.put("PR", 17.75);
        map.put("ON", 67.97);
        map.put("ARQT", 10.18);
        map.put("DVN", 53.69);
        map.put("QS", 5.82);
        map.put("AAPL", 175.36);
        map.put("RY", 99.0);
        map.put("SB", 4.75);
        map.put("SE", 53.37);
        map.put("TS", 38.96);
        map.put("PERI", 12.58);
        map.put("VZ", 40.12);
        map.put("PERF", 2.66);
        map.put("RCEL", 9.92);
        map.put("EVRG", 51.28);
        map.put("TH", 10.72);
        map.put("SO", 69.27);
        map.put("EVTL", 0.8323);
        map.put("TD", 56.98);
        map.put("LILAK", 7.29);
        map.put("MLM", 610.0);
        map.put("ST", 34.92);
        map.put("SQ", 77.53);
        map.put("MMM", 91.96);
        map.put("WU", 13.2);
        map.put("SWKH", 17.16);
        map.put("WW", 1.8);
        map.put("CPNG", 21.52);
        map.put("MOD", 93.0);
        map.put("IRBT", 7.86);
        map.put("ZS", 182.05);
        map.put("WM", 207.19);
        map.put("GTLS", 154.5);
        map.put("SWKS", 102.89);
        map.put("MPW", 4.83);
        map.put("ZM", 61.7);
        map.put("LAZR", 1.36);
        map.put("NYCB", 2.87);
        map.put("MRK", 127.71);
        map.put("MTB", 139.4);
        map.put("ZBRA", 292.71);
        map.put("VFC", 12.3);
        map.put("EDU", 85.32);
        map.put("IREN", 4.58);
        map.put("ASAI", 13.3);
        map.put("MUX", 11.67);
        map.put("BMRN", 92.65);
        map.put("EGO", 15.3);
        map.put("VIR", 8.97);
        map.put("LSCC", 75.8);
        map.put("VIV", 9.46);
        map.put("ELV", 503.38);
        map.put("MMYT", 69.14);
        map.put("NYMT", 7.0);
        map.put("ENPH", 116.51);
        map.put("ELP", 7.17);
        map.put("VLD", 0.311);
        map.put("VMC", 267.71);
        map.put("PNNT", 6.86);
        map.put("ELS", 61.33);
        map.put("ABBV", 164.4);
        map.put("ABEV", 2.32);
        map.put("EWBC", 73.41);
        map.put("VLO", 175.18);
        map.put("TRMD", 33.11);
        map.put("BEKE", 13.44);
        map.put("TROW", 117.31);
        map.put("VNO", 27.3);
        map.put("SOFI", 7.34);
        map.put("CHMI", 3.43);
        map.put("EOG", 133.93);
        map.put("HOLI", 25.49);
        map.put("SONY", 83.7);
        map.put("DCBO", 44.94);
        map.put("TAOP", 1.04);
        map.put("ENTG", 135.24);
        map.put("HOLX", 78.08);
        map.put("VRM", 12.0);
        map.put("VRT", 85.45);
        map.put("VST", 70.3);
        map.put("CHPT", 1.63);
        map.put("ERJ", 24.64);
        map.put("ERO", 20.74);
        map.put("HOOD", 18.063);
        map.put("ASML", 986.2);
        map.put("LSXMA", 25.98);
        map.put("TROO", 1.25);
        map.put("BEPC", 22.36);
        map.put("GLPG", 30.41);
        map.put("ETN", 323.12);
        map.put("ABNB", 161.67);
        map.put("OCGN", 1.67);
        map.put("CHTR", 262.94);
        map.put("NEM", 38.9);
        map.put("ASPN", 15.96);
        map.put("ETR", 103.3);
        map.put("OKTA", 98.05);
        map.put("TRUP", 23.39);
        map.put("NET", 92.92);
        map.put("NEP", 27.73);
        map.put("NGL", 6.01);
        map.put("NEE", 63.97);
        map.put("XERS", 1.9);
        map.put("AKAN", 0.1555);
        map.put("MESO", 5.4);
        map.put("SOUN", 4.35);
        map.put("MNDY", 193.99);
        map.put("EXC", 36.74);
        map.put("OTLK", 8.5);
        map.put("NIO", 4.19);
        map.put("NOG", 43.13);
        map.put("WBA", 17.92);
        map.put("FREY", 1.89);
        map.put("NMG", 2.13);
        map.put("FREE", 4.83);
        map.put("NOK", 3.4);
        map.put("META", 516.23);
        map.put("CHWY", 17.66);
        map.put("NOW", 769.32);
        map.put("FITB", 35.11);
        map.put("MNMD", 10.036);
        map.put("ASTS", 2.16);
        map.put("RLYB", 2.0);
        map.put("NKE", 93.72);
        map.put("FRHC", 67.35);
        map.put("CMCSA", 39.77);
        map.put("TSCO", 248.7);
        map.put("NSC", 250.39);
        map.put("WDS", 19.47);
        map.put("FCX", 50.73);
        map.put("MNPR", 0.7599);
        map.put("WEC", 79.0);
        map.put("FDX", 270.0);
        map.put("SPCE", 1.085);
        map.put("SPCB", 0.37);
        map.put("WDC", 73.05);
        map.put("TSEM", 32.02);
        map.put("WFC", 57.6);
        map.put("FANG", 208.23);
        map.put("NWS", 25.37);
        map.put("BNTX", 86.23);
        map.put("KYMR", 36.0);
        map.put("MNTS", 0.408);
        map.put("NWE", 48.86);
        map.put("ACAD", 17.2);
        map.put("WHR", 108.3);
        map.put("FRPT", 109.8);
        map.put("CIFR", 3.84);
        map.put("FIP", 7.17);
        map.put("FIS", 72.53);
        map.put("EXAS", 70.63);
        map.put("TSLA", 170.18);
        map.put("WMT", 60.47);
        map.put("FAST", 71.4);
        map.put("CINF", 119.83);
        map.put("WNW", 1.15);
        map.put("OLLI", 72.21);
        map.put("ACGL", 91.06);
        map.put("IBKR", 112.06);
        map.put("NINE", 2.83);
        map.put("FOX", 27.89);
        map.put("POOL", 382.76);
        map.put("EOSE", 0.88);
        map.put("RDWR", 16.7);
        map.put("WRK", 49.11);
        map.put("EXFY", 1.43);
        map.put("FRO", 24.18);
        map.put("WTW", 264.28);
        map.put("WSM", 297.47);
        map.put("ISRG", 392.12);
        map.put("LCID", 2.515);
        map.put("DLTR", 127.28);
        map.put("WRB", 83.56);
        map.put("CRBG", 27.4);
        map.put("SPOT", 302.0);
        map.put("FTI", 25.9);
        map.put("IBRX", 5.15);
        map.put("ODFL", 224.96);
        map.put("ATOM", 6.0);
        map.put("LLAP", 1.475);
        map.put("SHEL", 72.52);
        map.put("FSM", 4.66);
        map.put("CADL", 6.45);
        map.put("ALBT", 0.3298);
        map.put("OGN", 17.6);
        map.put("PXMD", 0.6862);
        map.put("EXPE", 131.5);
        map.put("ALCC", 12.76);
        map.put("TKLF", 0.235);
        map.put("ALGM", 26.99);
        map.put("EXTR", 11.35);
        map.put("REFI", 15.51);
        map.put("SPWR", 2.445);
        map.put("BWXT", 95.6);
        map.put("DDOG", 127.62);
        map.put("CRKN", 0.056);
        map.put("ALGN", 319.88);
        map.put("GEHC", 87.64);
        map.put("REGN", 916.97);
        map.put("CRNC", 13.36);
        map.put("SHOP", 70.08);
        map.put("TCBP", 1.51);
        map.put("ALLY", 37.71);
        map.put("RELL", 9.62);
        map.put("GCT", 33.44);
        map.put("ALLR", 2.33);
        map.put("ORA", 64.39);
        map.put("CAMT", 80.69);
        map.put("OPK", 1.24);
        map.put("RVNC", 4.1);
        map.put("CRSP", 60.4999);
        map.put("RVPH", 3.56);
        map.put("GEN", 21.14);
        map.put("MXCT", 4.0);
        map.put("MGAM", 0.1239);
        map.put("BORR", 5.78);
        map.put("TTEC", 8.24);
        map.put("RNAZ", 0.639);
        map.put("FSLY", 13.57);
        map.put("CRWD", 310.68);
        map.put("OUT", 15.83);
        map.put("XEL", 53.35);
        map.put("ICFI", 144.58);
        map.put("OWL", 18.57);
        map.put("GES", 27.74);
        map.put("OVV", 54.0);
        map.put("ICCM", 1.36);
        map.put("RENT", 21.85);
        map.put("GENI", 5.38);
        map.put("FSLR", 181.7404);
        map.put("ICHR", 39.22);
        map.put("GERN", 3.68);
        map.put("OXY", 69.23);
        map.put("RVSN", 1.26);
        map.put("GIS", 66.39);
        map.put("WDAY", 264.47);
        map.put("ADBE", 478.36);
        map.put("GME", 10.83);
        map.put("PCG", 16.7);
        map.put("CSCO", 49.77);
        map.put("PBR", 15.61);
        map.put("GPN", 126.6);
        map.put("PBI", 4.08);
        map.put("PDD", 117.09);
        map.put("ITRN", 26.57);
        map.put("JOBY", 4.66);
        map.put("GPS", 22.84);
        map.put("XPO", 127.36);
        map.put("REZI", 22.05);
        map.put("TCOM", 50.05);
        map.put("XOM", 121.09);
        map.put("VIST", 43.55);
        map.put("LUMN", 1.3808);
        map.put("PCT", 5.61);
        map.put("GSK", 40.86);
        map.put("LUNA", 2.55);
        map.put("GTN", 5.58);
        map.put("WULF", 2.02);
        map.put("PEP", 169.36);
        map.put("BXSL", 30.82);
        map.put("GWW", 975.0);
        map.put("XYL", 129.2);
        map.put("KALV", 11.89);
        map.put("PGR", 208.32);
        map.put("KRNL", 10.83);
        map.put("AMAT", 212.0);
        map.put("CSGP", 91.76);
        map.put("GWAV", 0.1229);
        map.put("KRNY", 5.81);
        map.put("KALU", 91.54);
        map.put("VALE", 12.03);
        map.put("PFS", 14.06);
        map.put("LULU", 340.93);
        map.put("AUPH", 5.1);
        map.put("PFE", 25.92);
        map.put("TTWO", 147.55);
        map.put("CSIQ", 15.75);
        map.put("ADSK", 240.14);
        map.put("VRNT", 30.34);
        map.put("HIFS", 164.84);
        map.put("AUTL", 4.98);
        map.put("AUVI", 0.7902);
        map.put("PNR", 82.72);
        map.put("LUXH", 1.2905);
        map.put("PLL", 15.53);
        map.put("AMGN", 270.8);
        map.put("PYPL", 65.14);
        map.put("PKG", 186.27);
        map.put("DELL", 119.0);
        map.put("VRSN", 187.13);
        map.put("VRSK", 225.04);
        map.put("PNC", 152.94);
        map.put("XPEV", 7.5);
        map.put("HIMS", 13.99);
        map.put("VRTX", 400.92);
        map.put("AMKR", 32.89);
        map.put("TLRY", 1.83);
        map.put("HBM", 7.73);
        map.put("HAL", 40.19);
        map.put("AMLX", 2.11);
        map.put("HCC", 61.92);
        map.put("SINT", 0.0233);
        map.put("PHUN", 7.1);
        map.put("VAXX", 0.537);
        map.put("LMND", 16.63);
        map.put("IDEX", 0.89);
        map.put("PTC", 182.47);
        map.put("ZETA", 11.95);
        map.put("EQNR", 27.85);
        map.put("QCOM", 174.45);
        map.put("PXD", 273.06);
        map.put("AMPG", 2.57);
        map.put("PUK", 18.01);
        map.put("SITC", 13.78);
        map.put("FTNT", 66.89);
        map.put("HDB", 57.38);
        map.put("AMRK", 40.7);
        map.put("HII", 278.7);
        map.put("HLN", 8.15);
        map.put("DNMR", 0.82);
        map.put("HLT", 209.91);
        map.put("SAFE", 19.24);
        map.put("HLF", 8.1);
        map.put("MPWR", 671.84);
        map.put("GOEV", 2.33);
        map.put("GOGO", 8.31);
        map.put("GOGL", 12.99);
        map.put("AVGO", 1370.81);
        map.put("HLX", 11.62);
        map.put("HON", 198.12);
        map.put("LECO", 241.05);
        map.put("AEHL", 1.55);
        map.put("NKLA", 0.7084);
        map.put("ROKU", 59.86);
        map.put("HPE", 17.62);
        map.put("GOLD", 17.78);
        map.put("BYND", 6.6);
        map.put("TDOC", 14.11);
        map.put("NTCT", 19.68);
        map.put("SANW", 0.43);
        map.put("IMAQ", 11.36);
        map.put("HRL", 34.05);
        map.put("EZGO", 1.85);
        map.put("HTZ", 6.88);
        map.put("TMDX", 93.68);
        map.put("HSY", 185.48);
        map.put("TDUP", 1.71);
        map.put("HWM", 65.07);
        map.put("DNUT", 14.75);
        map.put("MYNA", 5.19);
        map.put("NTAP", 102.8);
        map.put("GOOG", 160.41);
        map.put("AMZN", 187.41);
        map.put("ONVO", 1.66);
        map.put("SAVE", 4.29);
        map.put("SATL", 1.7);
        map.put("AVTX", 14.74);
        map.put("RGEN", 174.03);
        map.put("NCLH", 18.1);
        map.put("SATS", 14.26);
        map.put("PAAS", 19.29);
        map.put("BHVN", 51.5);
        map.put("IMNM", 21.8);
        map.put("SAVA", 23.0);
        map.put("FUBO", 1.47);
        map.put("ZBH", 126.0);
        map.put("IMPP", 3.57);
        map.put("AEYE", 13.75);
        map.put("ROST", 138.33);
        map.put("UPST", 23.8);
        map.put("PINS", 33.51);
        map.put("PACB", 3.2);
        map.put("UPLD", 2.51);
        map.put("DOCU", 58.88);
        map.put("LEXX", 2.08);
        map.put("ANET", 274.65);
        map.put("HRZN", 11.26);
        map.put("IAS", 9.81);
        map.put("CCOI", 63.57);
        map.put("DOCN", 35.0);
        map.put("FLYW", 21.3);
        map.put("TMUS", 162.08);
        map.put("ZIM", 10.11);
        map.put("IBN", 25.92);
        map.put("CTSH", 70.18);
        map.put("TECK", 48.57);
        map.put("NTRS", 84.79);
        map.put("IDN", 3.378);
        map.put("CTRA", 27.88);
        map.put("ICL", 4.74);
        map.put("CCSI", 12.53);
        map.put("RGLD", 120.33);
        map.put("PZZA", 62.4);
        map.put("IFF", 84.0);
        map.put("IFS", 23.11);
        map.put("ZIP", 10.92);
        map.put("HBAN", 13.44);
        map.put("HSBC", 41.27);
        map.put("IBM", 186.11);
        map.put("BIDU", 98.43);
        map.put("BIIB", 198.94);
        map.put("ANSS", 338.2);
        map.put("VKTX", 68.72);
        map.put("BIGC", 6.24);
        map.put("FUTU", 58.32);
        map.put("PRME", 5.72);
        map.put("PANW", 279.63);
        map.put("PRTH", 3.16);
        map.put("GOOGL", 158.93);
        map.put("RPHM", 1.72);
        map.put("DXCM", 137.82);
        map.put("CLNE", 2.44);
        map.put("SSNT", 12.99);
        map.put("PATH", 20.61);
        map.put("VTGN", 4.95);
        map.put("IPX", 14.8);
        map.put("BILL", 61.8);
        map.put("HBNC", 11.55);
        map.put("RCL", 130.12);
        map.put("INDI", 6.37);
        map.put("NDAQ", 62.25);
        map.put("AAP", 72.0);
        map.put("IRM", 76.68);
        map.put("AAL", 13.27);
        map.put("ABR", 12.3);
        map.put("ABT", 110.26);
        map.put("ZTS", 150.88);
        map.put("TERN", 5.05);
        map.put("BIPC", 30.22);
        map.put("ADI", 194.87);
        map.put("AEP", 82.39);
        map.put("AEO", 23.36);
        map.put("ADP", 247.4);
        map.put("AEM", 62.15);
        map.put("REG", 58.83);
        map.put("ADM", 61.21);
        map.put("INCR", 2.49);
        map.put("RFL", 1.84);
        map.put("INFA", 37.54);
        map.put("INCY", 54.05);
        map.put("ZUO", 8.65);
        map.put("ACN", 314.92);
        map.put("ADT", 6.37);
        map.put("CLSK", 14.85);
        map.put("SSRM", 5.2);
        map.put("GPRK", 9.85);
        map.put("AFL", 80.73);
        map.put("TNGX", 7.32);
        map.put("PAYO", 4.83);
        map.put("AIG", 74.6);
        map.put("VTNR", 1.07);
        map.put("KTOS", 18.27);
        map.put("SBUX", 85.39);
        map.put("BRFS", 3.35);
        map.put("PAYX", 124.09);
        map.put("MIRM", 24.51);
        map.put("RIG", 6.19);
        map.put("SBSW", 5.45);
        map.put("BREZ", 11.59);
        map.put("BABA", 71.75);
        map.put("TEVA", 13.51);
        map.put("MITK", 15.0);
        map.put("AIV", 8.11);
        map.put("INMD", 18.0);
        map.put("KLAC", 690.09);
        map.put("YUMC", 37.8);
        map.put("MAIN", 47.19);
        map.put("ALT", 7.95);
        map.put("RMR", 24.04);
        map.put("AMC", 2.67);
        map.put("LOGI", 83.87);
        map.put("ALV", 118.08);
        map.put("ALK", 41.36);
        map.put("ROL", 44.0);
        map.put("CDLX", 13.63);
        map.put("ROK", 289.0);
        map.put("BRKR", 88.31);
        map.put("MRIN", 3.29);
        map.put("ALB", 123.4);
        map.put("AMD", 164.39);
        map.put("ROP", 542.7);
        map.put("ALC", 82.15);
        map.put("VTRS", 11.44);
        map.put("INTR", 5.49);
        map.put("ARE", 123.63);
        map.put("RSG", 189.48);
        map.put("BROG", 1.46);
        map.put("INTU", 629.28);
        map.put("JBI", 14.58);
        map.put("ANF", 113.0);
        map.put("PSEC", 5.39);
        map.put("CDNS", 310.32);
        map.put("RPD", 48.0);
        map.put("AOS", 87.76);
        map.put("APP", 74.31);
        map.put("JCI", 66.0);
        map.put("MRNA", 105.05);
        map.put("ANY", 1.08);
        map.put("APA", 33.54);
        map.put("MRNS", 1.87);
        map.put("CMCM", 4.69);
        map.put("ARR", 18.37);
        map.put("STBX", 0.244);
        map.put("RTX", 101.9);
        map.put("ASX", 11.05);
        map.put("FELE", 101.05);
        map.put("RUN", 11.4276);
        map.put("INTC", 36.09);
        map.put("INVZ", 1.22);
        map.put("OPEN", 2.36);
        map.put("JFU", 3.11);
        map.put("AUR", 3.07);
        map.put("NDSN", 266.63);
        map.put("SCCO", 118.44);
        map.put("HTGC", 18.31);
        map.put("AWR", 67.9);
        map.put("AOSL", 22.01);
        map.put("MASS", 6.06);
        map.put("FVRR", 20.34);
        map.put("STEM", 1.77);
        map.put("TNXP", 0.1623);
        map.put("LXEH", 0.385);
        map.put("FERG", 220.29);
        map.put("MARA", 16.16);
        map.put("AXP", 222.22);
        map.put("HTHT", 38.51);
        map.put("ESRT", 9.12);
        map.put("STGW", 5.59);
        map.put("PSNY", 1.34);
        map.put("MRVL", 71.26);
        map.put("ESTC", 97.16);
        map.put("SAM", 283.8);
        map.put("URBN", 39.08);
        map.put("JOE", 57.9);
        map.put("JPM", 184.03);
        map.put("SCHW", 70.38);
        map.put("STLA", 27.05);
        map.put("JNJ", 148.3);
        map.put("AGEN", 8.65);
        map.put("NVAX", 4.42);
        map.put("CVAC", 2.92);
        map.put("BAM", 39.8);
        map.put("STLD", 142.28);
        map.put("BAH", 144.5);
        map.put("BAC", 36.2);
        map.put("SCM", 13.39);
        return map;
    }

    public static void main(String[] args) throws Exception {
        double init = 10000;
        Map<String/* date */, Map<String/* stock */, Double/* ratio */>> dateToStockRatioMap = Maps.newTreeMap(Comparator.comparing(BaseUtils::dateToInt));
        Map<String/* date */, Map<String/* stock */, StockKLine>> dateToStockMap = Maps.newHashMap();

        Map<String, String> klineFileMap = BaseUtils.getFileMap(Constants.HIS_BASE_PATH + "2024/dailyKLine");
        //        Map<String, String> klineFileMap = BaseUtils.getFileMap(Constants.HIS_BASE_PATH + "2023daily");
        Map<String, Boolean> marginInfoMap = BaseUtils.getMarginInfoMap();
        int year = 2024;
        Set<String> optionStock = BaseUtils.getOptionStock();
        for (String stock : optionStock) {
            if (!marginInfoMap.containsKey(stock)) {
                continue;
            }

            String filePath = klineFileMap.get(stock);

            List<StockKLine> stockKLines = BaseUtils.loadDataToKline(filePath, year, year - 1);
            for (int i = 0; i < stockKLines.size() - 2; i++) {
                StockKLine prevKline = stockKLines.get(i + 1);
                StockKLine kline = stockKLines.get(i);
                double prevClose = prevKline.getClose();
                double open = kline.getOpen();
                String date = kline.getDate();

                if (open > prevClose) {
                    continue;
                }

                double ratio = (prevClose - open) / prevClose * 100;
                if (!dateToStockRatioMap.containsKey(date)) {
                    dateToStockRatioMap.put(date, Maps.newHashMap());
                }
                dateToStockRatioMap.get(date).put(stock, ratio);

                if (!dateToStockMap.containsKey(date)) {
                    dateToStockMap.put(date, Maps.newHashMap());
                }
                dateToStockMap.get(date).put(stock, kline);
            }
        }

        // 根据跌幅倒排股票列表
        Map<String/* date */, List<String>/* stock */> dateToStockListMap = Maps.newHashMap();
        for (String date : dateToStockRatioMap.keySet()) {
            Map<String, Double> ratioMap = dateToStockRatioMap.get(date);
            List<String> stockList = ratioMap.entrySet().stream()
              .sorted((o1, o2) -> o2.getValue().compareTo(o1.getValue())).map(o -> o.getKey()).collect(Collectors.toList());
            dateToStockListMap.put(date, stockList);
        }

        double sum = init;
        double v = 0.07;
        double gainCount = 0, lossCount = 0;
        boolean show = false;
        for (String date : dateToStockRatioMap.keySet()) {
            List<String> stockList = dateToStockListMap.get(date);

            for (String stock : stockList) {
                Boolean canShortSell = MapUtils.getBoolean(marginInfoMap, stock, false);
                if (!canShortSell) {
//                    continue;
                }

                StockKLine kLine = dateToStockMap.get(date).get(stock);
                double open = kLine.getOpen();
                double close = kLine.getClose();
                BigDecimal volume = kLine.getVolume();
                double high = kLine.getHigh();
                double low = kLine.getLow();
                if (open < 7) {
                                        continue;
                }

                int count = (int) (sum / open);
                double income = 0;
                //                double lossRatio = (high - open) / open;
                double lossRatio = (open - low) / open;
                if (lossRatio > v) {
                    double loss = -count * open * v;
                    income = loss;
                    if (show) {
                        System.out.println("date=" + date + ", stock=" + stock + ", open=" + open + ", close=" + close + ", volumn=" + volume + ", count=" + count + ", loss = " + (int) loss);
                    }
                    lossCount++;
                } else {
                    //                    double gain = count * (open - close);
                    double gain = count * (close - open);
                    income = gain;
                    if (show) {
                        System.out.println("date=" + date + ", stock=" + stock + ", open=" + open + ", close=" + close + ", volumn=" + volume + ", count=" + count + ", gain = " + (int) gain);
                    }

                    if (gain >= 0) {
                        gainCount++;
                    } else {
                        lossCount++;
                    }
                }
                sum += income;
                Double ratio = dateToStockRatioMap.get(date).get(stock);
                if (show) {
                    System.out.println("date=" + date + ", income=" + income + ", sum=" + sum + ", ratio=" + ratio);
                }

                double highOpenDiffRatio = (high - open) / open * 100;
                double lowOpenDiffRatio = (open - low) / open * 100;
                System.out.println("date=" + date + ", code=" + stock + ", open=" + open + ", ratio=" + ratio + ", highOpenDiffRatio=" + highOpenDiffRatio + ", lowOpenDiffRatio=" + lowOpenDiffRatio);

                break;
            }
        }

        double successRatio = gainCount / (gainCount + lossCount);
        System.out.println("gainCount=" + gainCount + ", lossCount=" + lossCount + ", ratio=" + successRatio);
        System.out.println();
    }
}
